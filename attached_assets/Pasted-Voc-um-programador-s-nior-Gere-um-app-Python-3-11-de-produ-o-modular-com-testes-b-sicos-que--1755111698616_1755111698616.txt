Voc√™ √© um programador s√™nior. Gere um app Python 3.11 de produ√ß√£o, modular, com testes b√°sicos, que:

1) Objetivo
Ler feeds RSS na ordem definida, extrair a mat√©ria completa (t√≠tulo, resumo, conte√∫do integral, todas as imagens e v√≠deos/YouTube incorporados, categorias e tags).

Reescrever o conte√∫do com IA usando um prompt externo (universal_prompt.txt) exatamente no formato enviado abaixo (T√≠tulo/Resumo/Conte√∫do), sem perder informa√ß√£o, apenas reestruturando e otimizando para SEO.

Publicar automaticamente no WordPress via REST, preenchendo: t√≠tulo, conte√∫do HTML reestruturado, excerpt (resumo), categoria correta, tags, imagem destacada (quando aplic√°vel) e status publish.

Rodar em ciclo com APScheduler, respeitando limites (chave de API, cad√™ncia e rate limit).

Aplicar pr√°ticas de SEO para Google News/Discover, deixando o Yoast SEO trabalhar automaticamente a partir de t√≠tulo, excerpt e conte√∫do. (Se a API permitir, setar tamb√©m meta description e focus keyword via post meta; caso o endpoint n√£o suporte, ignore silenciosamente.)

2) Configura√ß√£o (use ENV; n√£o hardcode segredos)
Reproduza as constantes abaixo (j√° existentes) e fa√ßa o app ler as chaves e credenciais de os.getenv. Se alguma vari√°vel faltar, log cr√≠tico e seguir para a pr√≥xima feed/task sem quebrar o processo.

python
Copiar
Editar
PIPELINE_ORDER = [
    'screenrant_movies','screenrant_tv',
    'movieweb_movies',
    'collider_movies','collider_tv',
    'cbr_movies','cbr_tv',
    'gamerant_games','thegamer_games',
]

RSS_FEEDS = {
    'screenrant_movies': {'urls': ['https://screenrant.com/feed/movie-news/'], 'category': 'movies'},
    'screenrant_tv':     {'urls': ['https://screenrant.com/feed/tv-news/'],    'category': 'series'},
    'movieweb_movies':   {'urls': ['https://movieweb.com/feed/'],               'category': 'movies'},
    'collider_movies':   {'urls': ['https://collider.com/feed/category/movie-news/'], 'category': 'movies'},
    'collider_tv':       {'urls': ['https://collider.com/feed/category/tv-news/'],    'category': 'series'},
    'cbr_movies':        {'urls': ['https://www.cbr.com/feed/category/movies/news-movies/'], 'category': 'movies'},
    'cbr_tv':            {'urls': ['https://www.cbr.com/feed/category/tv/news-tv/'],         'category': 'series'},
    'gamerant_games':    {'urls': ['https://gamerant.com/feed/gaming/'],        'category': 'games'},
    'thegamer_games':    {'urls': ['https://www.thegamer.com/feed/category/game-news/'], 'category': 'games'}
}

USER_AGENT = 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'

AI_CONFIG = {
    'movies': [os.getenv('GEMINI_MOVIES_1'), os.getenv('GEMINI_MOVIES_2'), os.getenv('GEMINI_MOVIES_3'),
               os.getenv('GEMINI_MOVIES_4'), os.getenv('GEMINI_BACKUP_1'), os.getenv('GEMINI_BACKUP_2')],
    'series': [os.getenv('GEMINI_SERIES_1'), os.getenv('GEMINI_SERIES_2'), os.getenv('GEMINI_SERIES_3'),
               os.getenv('GEMINI_BACKUP_3'), os.getenv('GEMINI_BACKUP_4')],
    'games':  [os.getenv('GEMINI_GAMES_1'), os.getenv('GEMINI_GAMES_2'), os.getenv('GEMINI_BACKUP_5')],
}

WORDPRESS_CONFIG = {
    'url': os.getenv('WORDPRESS_URL'),      # ex: https://maquinanerd.com.br/wp-json/wp/v2/
    'user': os.getenv('WORDPRESS_USER'),
    'password': os.getenv('WORDPRESS_PASSWORD')
}

WORDPRESS_CATEGORIES = {
    'Not√≠cias': 20, 'Filmes': 24, 'S√©ries': 21, 'Games': 73,
}

SCHEDULE_CONFIG = {
    'check_interval': 15,          # minutos
    'max_articles_per_feed': 3,    # por ciclo
    'api_call_delay': 30,          # segundos entre chamadas √† IA
    'cleanup_after_hours': 12
}

PIPELINE_CONFIG = {
    'images_mode': os.getenv('IMAGES_MODE', 'hotlink'),  # 'hotlink' | 'download_upload'
    'attribution_policy': 'Via {domain}',
    'publisher_name': 'M√°quina Nerd',
    'publisher_logo_url': 'https://www.maquinanerd.com.br/wp-content/uploads/2023/11/logo-maquina-nerd-400px.png'
}
3) Arquitetura e m√≥dulos
Crie um pacote app/ com:

main.py: inicia scheduler, registra jobs de pipeline e cleanup.

feeds.py: leitura de RSS com feedparser, normaliza√ß√£o (GUID, link, t√≠tulo, data), dedupe por (source_id, guid|link).

extractor.py: baixar HTML do artigo com requests (USER_AGENT), extrair conte√∫do completo (t√≠tulo, resumo se houver, corpo, imagens, iframes/YouTube) usando trafilatura (preferencial) com fallback para readability-lxml + BeautifulSoup4. Preservar iframes do YouTube e imagens do corpo; capturar imagem principal (og:image ou primeira imagem do conte√∫do).

ai_processor.py: sele√ß√£o de chave ativa por categoria com failover (tentar pr√≥xima chave se 4xx/429/5xx), backoff exponencial e api_call_delay. Carrega universal_prompt.txt do diret√≥rio raiz. Monta o payload substituindo {title}, {excerpt}, {tags_text}, {content} e pede sa√≠da somente no formato exigido (Novo T√≠tulo/Resumo/Conte√∫do).

rewriter.py: valida e sana a sa√≠da da IA:

Garante que o t√≠tulo seja texto puro (sem HTML).

Resumo: texto curto objetivo.

Conte√∫do: cada par√°grafo envolto em <p>...</p>, sem <br>, e apenas com <b> e <a> quando necess√°rio.

Mant√©m todas as m√≠dias do original: imagens, <figure>, <img>, <iframe> do YouTube.

Links internos: com base nas tags extra√≠das do artigo (ver tags.py), insere <a href="{domain}/tag/slug"> com op√ß√£o de <b> combinado. N√£o inventar tags; usar somente as detectadas.

Negrito apenas para termos relevantes (t√≠tulos de obras, personagens, plataformas, datas/eventos).

tags.py: extrai tags do conte√∫do original (nomes de franquias, atores, plataformas) via heur√≠sticas + listas de apoio; devolve lista/slug. N√£o crie tags gen√©ricas vazias. tags_text √© a jun√ß√£o/legenda usada no prompt.

categorizer.py: mapeia feed ‚Üí categoria WP (Filmes, S√©ries, Games). Se o feed ‚Äú_movies‚Äù ‚Üí Filmes; ‚Äú_tv‚Äù ‚Üí S√©ries; ‚Äú*_games‚Äù ‚Üí Games.

media.py: pol√≠tica de imagens:

hotlink: manter src original.

download_upload: baixar imagens principais e relevantes, subir para /wp/v2/media (REST), setar featured_media.

Sempre que poss√≠vel, definir imagem destacada a partir da imagem principal.

wordpress.py: autentica√ß√£o b√°sica (user/password), cria√ß√£o de post (/wp/v2/posts), set de categories, tags (criar tag se n√£o existir via /wp/v2/tags), excerpt, featured_media e status. Se permitido, tentar setar metadados Yoast (_yoast_wpseo_metadesc, _yoast_wpseo_focuskw) ‚Äî tentar e ignorar erros se a API n√£o expuser esses campos. Montar dom√≠nio base a partir de WORDPRESS_CONFIG['url'] para links internos (ex.: https://www.maquinanerd.com.br).

store.py: SQLite (data/app.db) para:

seen_articles(source_id, external_id, published_at, inserted_at)

failures(log...) e posts(post_id, source_id, external_id, wp_post_id).

logging_conf.py: logging em arquivo rotativo e console (n√≠vel INFO, DEBUG opcional).

cleanup.py: remove registros e arquivos tempor√°rios antigos (> cleanup_after_hours).

4) Fluxo do pipeline
Para cada source_id em PIPELINE_ORDER:

Ler RSS; para cada item novo (respeitar max_articles_per_feed por ciclo):

Resolver URL final (follow redirects), baixar HTML.

Extrair: t√≠tulo original, resumo/lead se houver, conte√∫do integral + m√≠dias, imagem principal, data/hora.

Derivar tags e tags_text.

Montar prompt carregado de universal_prompt.txt (ver abaixo) e chamar IA (categoria certa: movies/series/games).

Validar/normalizar a sa√≠da da IA.

Inserir links internos conforme tags e dom√≠nio WP.

Tratar imagens segundo PIPELINE_CONFIG['images_mode']. Se download_upload, subir m√≠dia e definir featured_media.

Mapear categoria WP (ID em WORDPRESS_CATEGORIES).

Publicar via REST. Salvar wp_post_id. Marcar item como processado no SQLite.

Pausar SCHEDULE_CONFIG['api_call_delay'] antes da pr√≥xima chamada de IA.

Repetir a cada check_interval minutos com APScheduler.

5) Resili√™ncia
Retries com backoff em: rede, 429, 5xx e erros transit√≥rios na IA/WordPress.

Failover de chave IA: iterar lista em AI_CONFIG[category].

Dedupe por (source_id, guid/link canonizado).

Sanitiza√ß√£o de HTML final (permitir apenas <p>, <b>, <a>, <figure>, <img>, <iframe> do YouTube).

Timeouts razo√°veis (requests 15s) e valida√ß√£o de tamanho (n√£o publicar posts vazios).

6) Depend√™ncias
feedparser, trafilatura, readability-lxml, beautifulsoup4, lxml, requests, python-dateutil, apscheduler, python-slugify, urllib3, pillow (se download_upload), sqlite3 (padr√£o).

7) Prompt externo (salvar como universal_prompt.txt na raiz do projeto)
Voc√™ √© um jornalista digital especializado em cultura pop, cinema e s√©ries, com experi√™ncia em otimiza√ß√£o para Google News e SEO t√©cnico. Sua tarefa √© revisar e otimizar o conte√∫do abaixo sem alterar o sentido original, aprimorando sua estrutura, legibilidade e potencial de ranqueamento.

‚úÖ Diretrizes obrigat√≥rias para otimiza√ß√£o:

T√≠tulo:

Reescreva o t√≠tulo original tornando-o mais atrativo e claro.

Inclua palavras-chave relevantes para melhorar o SEO.

Mantenha foco no tema, sem clickbait exagerado.

‚ö†Ô∏è IMPORTANTE: O t√≠tulo deve ser APENAS TEXTO PURO, sem HTML, tags ou formata√ß√£o.

N√£o use <b>, <a>, <i>, <span> ou qualquer tag HTML no t√≠tulo.

Resumo (Excerpt):

Reescreva o resumo para ser mais chamativo e informativo.

Foque em engajamento e performance nos resultados do Google News.

Conte√∫do:

Reestruture os par√°grafos longos em blocos mais curtos e escane√°veis.

N√£o resuma ou encurte o texto. O objetivo √© reestruturar e otimizar, mantendo toda a informa√ß√£o original. Apenas melhore a fluidez e a formata√ß√£o.

‚ö†Ô∏è IMPORTANTE: Envolva cada par√°grafo individualmente com a tag HTML <p>. Exemplo: <p>Primeiro par√°grafo.</p><p>Segundo par√°grafo.</p>

N√£o use <br> para criar par√°grafos.

Mantenha o tom jornal√≠stico e objetivo.

N√£o altere o sentido da informa√ß√£o.

Negrito:

Destaque os termos mais relevantes usando apenas a tag HTML <b>.

Ex: nomes de filmes, personagens, diretores, plataformas, datas, eventos.

Links internos:

Baseando-se nas tags fornecidas, insira links internos usando a estrutura:
<a href="{domain}/tag/NOME-DA-TAG">Texto √¢ncora</a>

Quando poss√≠vel, aplique negrito combinado com link:
<b><a href="{domain}/tag/stranger-things">Stranger Things</a></b>

‚ö†Ô∏è Regras T√©cnicas:

Use somente HTML puro: <b>, <a>.

N√£o utilize Markdown (texto ou link).

N√£o adicione informa√ß√µes novas que n√£o estejam no texto original ou na m√≠dia fornecida.

Utilize o conte√∫do do campo Tags para decidir onde inserir links internos relevantes.

üîΩ DADOS DISPON√çVEIS PARA OTIMIZA√á√ÉO

T√≠tulo: {title}

Resumo: {excerpt}

Tags dispon√≠veis: {tags_text}

Conte√∫do:
{content}

üì§ FORMATO DA RESPOSTA (obrigat√≥rio)

Novo T√≠tulo:
(t√≠tulo otimizado)

Novo Resumo:
(resumo otimizado)

Novo Conte√∫do:
(conte√∫do reestruturado com par√°grafos curtos, <b>negrito</b> e <a href="">links internos</a>)

8) Regras de publica√ß√£o/SEO
T√≠tulo: usar exatamente o campo ‚ÄúNovo T√≠tulo‚Äù.

Excerpt: usar ‚ÄúNovo Resumo‚Äù.

Conte√∫do: usar ‚ÄúNovo Conte√∫do‚Äù j√° com <p>...</p>, <b> e <a> aplicados.

Categorias: mapear pelo feed para IDs em WORDPRESS_CATEGORIES.

Tags: criar/associar conforme tags.py. Slug em min√∫sculas, h√≠fen, sem acentos.

Yoast: deixe o plugin gerar meta a partir de t√≠tulo/excerpt/primeiro par√°grafo. Se a REST permitir, enviar tamb√©m:

_yoast_wpseo_metadesc = excerpt (ou primeira frase do resumo).

_yoast_wpseo_focuskw = 1‚Äì2 palavras-chave principais do t√≠tulo.

Google News: garantir consist√™ncia entre t√≠tulo, excerpt e conte√∫do; evitar HTML no t√≠tulo; manter imagens acess√≠veis (se download_upload, usar media_source_url).

9) Testes e utilit√°rios
Fun√ß√£o CLI python -m app.main --once para rodar um ciclo √∫nico (sem scheduler).

Testes unit√°rios m√≠nimos para categorizer, tags, rewriter (valida√ß√£o estrutural do HTML), e wordpress (mock de REST).

Makefile/requirements.txt e instru√ß√µes de execu√ß√£o no README.md.

Implemente tudo com c√≥digo limpo, tipado, docstrings, logs claros e tratamento de erros robusto. Ao finalizar, gere os arquivos, incluindo universal_prompt.txt exatamente como acima, prontos para execu√ß√£o.